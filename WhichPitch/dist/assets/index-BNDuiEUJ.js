(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function l(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(r){if(r.ep)return;r.ep=!0;const s=l(r);fetch(r.href,s)}})();let d=null;const G={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88};function F(n,o){const l=G[n],c=o-4;return l*Math.pow(2,c)}function w(){return d||(d=new(window.AudioContext||window.webkitAudioContext)),d}async function L(){d&&d.state==="suspended"&&await d.resume()}function f(n,o,l=.8){return new Promise(c=>{w(),L();const r=F(n,o),s=d.createOscillator(),a=d.createGain();s.type="sine",s.frequency.setValueAtTime(r,d.currentTime);const u=d.createOscillator();u.type="triangle",u.frequency.setValueAtTime(r*2,d.currentTime);const v=d.createGain();v.gain.setValueAtTime(.4,d.currentTime);const m=d.currentTime,S=.02,P=.1,q=.8;a.gain.setValueAtTime(0,m),a.gain.linearRampToValueAtTime(1,m+S),a.gain.linearRampToValueAtTime(q,m+S+P),a.gain.linearRampToValueAtTime(0,m+l),s.connect(a),u.connect(v),v.connect(a),a.connect(d.destination),s.start(m),u.start(m),s.stop(m+l),u.stop(m+l),setTimeout(()=>{c()},l*1e3)})}async function D(n,o=.6,l=.15){for(const c of n)await f(c.note,c.octave,o),await new Promise(r=>setTimeout(r,l*1e3))}const E=["C","D","E","F","G","A","B"],Q=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],p={kindergarten:{name:"ã‚ˆã†ã¡ãˆã‚“",notes:["C","D","E","F","G","A","B"],octaves:[4],includeSharps:!1,melodyLength:3,description:"ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚· ã ã‘ã§ã‚Œã‚“ã—ã‚…ã†ï¼"},elementary:{name:"å°å­¦ç”Ÿ",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[4],includeSharps:!0,melodyLength:4,description:"ç™½ã„éµç›¤ã¨é»’ã„éµç›¤ã‚’ã¤ã‹ã£ã¦ç·´ç¿’ï¼"},adult:{name:"å¤§äºº",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[3,4,5],includeSharps:!0,melodyLength:5,description:"å…¨éŸ³åŸŸã§ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼è©³ç´°è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚"}},R={C:"ãƒ‰","C#":"ãƒ‰â™¯",D:"ãƒ¬","D#":"ãƒ¬â™¯",E:"ãƒŸ",F:"ãƒ•ã‚¡","F#":"ãƒ•ã‚¡â™¯",G:"ã‚½","G#":"ã‚½â™¯",A:"ãƒ©","A#":"ãƒ©â™¯",B:"ã‚·"};let e={level:null,mode:null,settings:{octaveRange:"4",melodyLength:4,includeSharps:!0},currentQuestion:null,currentMelodyIndex:0,userAnswers:[],score:{correct:0,total:0,streak:0,maxStreak:0},isAnswered:!1};const t={levelSelection:document.getElementById("level-selection"),modeSelection:document.getElementById("mode-selection"),settingsPanel:document.getElementById("settings-panel"),gamePanel:document.getElementById("game-panel"),resultPanel:document.getElementById("result-panel"),kindergartenBtn:document.getElementById("kindergarten-btn"),elementaryBtn:document.getElementById("elementary-btn"),adultBtn:document.getElementById("adult-btn"),backToLevelBtn:document.getElementById("back-to-level-btn"),modeTitle:document.getElementById("mode-title"),singleModeBtn:document.getElementById("single-mode-btn"),melodyModeBtn:document.getElementById("melody-mode-btn"),settingsTitle:document.getElementById("settings-title"),levelInfo:document.getElementById("level-info"),octaveRange:document.getElementById("octave-range"),melodyLength:document.getElementById("melody-length"),includeSharps:document.getElementById("include-sharps"),startGameBtn:document.getElementById("start-game-btn"),backBtn:document.getElementById("back-btn"),correctCount:document.getElementById("correct-count"),totalCount:document.getElementById("total-count"),streakCount:document.getElementById("streak-count"),playBtn:document.getElementById("play-btn"),melodyProgress:document.getElementById("melody-progress"),currentNoteIndex:document.getElementById("current-note-index"),totalNotes:document.getElementById("total-notes"),pianoKeys:document.getElementById("piano-keys"),quitBtn:document.getElementById("quit-btn"),finalPercentage:document.getElementById("final-percentage"),finalCorrect:document.getElementById("final-correct"),finalTotal:document.getElementById("final-total"),maxStreak:document.getElementById("max-streak"),retryBtn:document.getElementById("retry-btn"),homeBtn:document.getElementById("home-btn"),correctModal:document.getElementById("correct-modal"),modalAnswer:document.getElementById("modal-answer"),modalStreak:document.getElementById("modal-streak"),modalNextBtn:document.getElementById("modal-next-btn"),wrongModal:document.getElementById("wrong-modal"),wrongModalAnswer:document.getElementById("wrong-modal-answer"),wrongModalNextBtn:document.getElementById("wrong-modal-next-btn")};function i(n){[t.levelSelection,t.modeSelection,t.settingsPanel,t.gamePanel,t.resultPanel].forEach(o=>o.classList.add("hidden")),n.classList.remove("hidden")}function y(n){return(e.level==="kindergarten"||e.level==="elementary")&&R[n]||n}function O(){t.pianoKeys.innerHTML="";const n=document.createElement("div");if(n.style.display="flex",n.style.position="relative",E.forEach((o,l)=>{const c=document.createElement("button");c.className="white-key",c.dataset.note=o,c.textContent=y(o),c.addEventListener("click",()=>I(o)),n.appendChild(c)}),e.settings.includeSharps){const o=[0,1,3,4,5],l=["C#","D#","F#","G#","A#"];o.forEach((c,r)=>{const s=document.createElement("button");s.className="black-key",s.dataset.note=l[r],s.textContent=y(l[r]),s.style.left=`${c*49+32}px`,s.addEventListener("click",()=>I(l[r])),n.appendChild(s)})}t.pianoKeys.appendChild(n)}function K(){const n=p[e.level];return e.level==="adult"?e.settings.includeSharps?Q:E:e.settings.includeSharps?n.notes:E}function V(){if(e.level==="adult"){const n=e.settings.octaveRange;return n==="3-5"?[3,4,5]:[parseInt(n)]}return p[e.level].octaves}function C(){const n=K(),o=V(),l=n[Math.floor(Math.random()*n.length)],c=o[Math.floor(Math.random()*o.length)];return{note:l,octave:c}}function $(n){const o=[];for(let l=0;l<n;l++)o.push(C());return o}function h(){e.isAnswered=!1,e.userAnswers=[],e.currentMelodyIndex=0,document.querySelectorAll(".white-key, .black-key").forEach(n=>{n.classList.remove("correct","wrong")}),t.resultDisplay.classList.add("hidden"),t.nextBtn.classList.add("hidden"),e.mode==="single"?e.currentQuestion=C():(e.currentQuestion=$(e.settings.melodyLength),t.totalNotes.textContent=e.settings.melodyLength,t.currentNoteIndex.textContent="1"),A()}function A(){e.mode==="melody"?(t.melodyProgress.classList.remove("hidden"),t.currentNoteIndex.textContent=e.currentMelodyIndex+1):t.melodyProgress.classList.add("hidden")}async function _(){if(await L(),e.mode==="single"){const{note:n,octave:o}=e.currentQuestion;await f(n,o)}else await D(e.currentQuestion)}function I(n){e.isAnswered&&e.mode==="single"||(e.mode==="single"?j(n):H(n))}function j(n){e.isAnswered=!0,e.score.total++;const o=e.currentQuestion.note,l=n===o;l?(e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak)):e.score.streak=0,g(),U(n,o,l);const c=e.currentQuestion.octave;f(n,c,.5),l?b(y(o)):M(y(o))}function H(n){const o=e.currentMelodyIndex,l=e.currentQuestion[o].note,c=n===l;e.userAnswers.push(n);const r=document.querySelector(`[data-note="${n}"]`);r&&(r.classList.add(c?"correct":"wrong"),setTimeout(()=>r.classList.remove("correct","wrong"),300));const s=e.currentQuestion[o].octave;if(f(n,s,.3),!c){e.isAnswered=!0,e.score.total++,e.score.streak=0;const a=e.currentQuestion.map(u=>y(u.note)).join(" â†’ ");M(a),g();return}if(e.currentMelodyIndex++,A(),e.currentMelodyIndex>=e.currentQuestion.length){e.isAnswered=!0,e.score.total++,e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak),g();const a=e.currentQuestion.map(u=>y(u.note)).join(" â†’ ");b(a)}}function U(n,o,l){const c=document.querySelector(`[data-note="${n}"]`),r=document.querySelector(`[data-note="${o}"]`);c&&c.classList.add(l?"correct":"wrong"),!l&&r&&r.classList.add("correct")}function g(){t.correctCount.textContent=e.score.correct,t.totalCount.textContent=e.score.total,t.streakCount.textContent=e.score.streak}function b(n){const o=e.level==="kindergarten"||e.level==="elementary";t.modalAnswer.textContent=n,t.modalStreak.textContent=e.score.streak,t.modalNextBtn.textContent=o?"âœ¨ ã¤ãŽã®ã‚‚ã‚“ã ã„ âœ¨":"âœ¨ æ¬¡ã®å•é¡Œ âœ¨",t.correctModal.classList.remove("hidden")}function M(n){const o=e.level==="kindergarten"||e.level==="elementary";t.wrongModalAnswer.textContent=n,t.wrongModalNextBtn.textContent=o?"âœ¨ ã¤ãŽã®ã‚‚ã‚“ã ã„ âœ¨":"âœ¨ æ¬¡ã®å•é¡Œ âœ¨",t.wrongModal.classList.remove("hidden")}function B(){t.correctModal.classList.add("hidden"),t.wrongModal.classList.add("hidden")}function W(){const n=e.score.total>0?Math.round(e.score.correct/e.score.total*100):0;t.finalPercentage.textContent=n,t.finalCorrect.textContent=e.score.correct,t.finalTotal.textContent=e.score.total,t.maxStreak.textContent=e.score.maxStreak,i(t.resultPanel)}function J(){e.score={correct:0,total:0,streak:0,maxStreak:0},e.currentQuestion=null,e.currentMelodyIndex=0,e.userAnswers=[],e.isAnswered=!1}function k(n){e.level=n;const o=p[n];e.settings.includeSharps=o.includeSharps,e.settings.melodyLength=o.melodyLength,e.settings.octaveRange=o.octaves.length>1?"3-5":String(o.octaves[0]),t.includeSharps.checked=o.includeSharps,t.melodyLength.value=String(o.melodyLength),t.octaveRange.value=e.settings.octaveRange}function T(){const n=p[e.level];t.levelInfo.innerHTML=`
    <span class="level-badge ${e.level}">${n.name}</span>
    <p>${n.description}</p>
  `}function x(){e.level==="kindergarten"?(t.modeTitle.textContent="ðŸŒ¸ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­ï¼ ðŸŒ¸",document.querySelector("#single-mode-btn .mode-title").textContent="ãŸã‚“ãŠã‚“ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®ãŠã¨ã‚’ã‚ã¦ã‚ˆã† ðŸŽµ",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="ãŠã¨ã‚’ã˜ã‚…ã‚“ã°ã‚“ã«ã‚ã¦ã‚ˆã† ðŸŽ¶"):(t.modeTitle.textContent="ðŸŽ€ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ ðŸŽ€",document.querySelector("#single-mode-btn .mode-title").textContent="å˜éŸ³ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®éŸ³ã‚’è´ã„ã¦å½“ã¦ã‚‹",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="è¤‡æ•°ã®éŸ³ã‚’é †ç•ªã«å½“ã¦ã‚‹")}function N(){J(),O(),g(),h(),i(t.gamePanel)}t.kindergartenBtn.addEventListener("click",()=>{k("kindergarten"),x(),i(t.modeSelection)});t.elementaryBtn.addEventListener("click",()=>{k("elementary"),x(),i(t.modeSelection)});t.adultBtn.addEventListener("click",()=>{k("adult"),x(),i(t.modeSelection)});t.backToLevelBtn.addEventListener("click",()=>{i(t.levelSelection)});t.singleModeBtn.addEventListener("click",()=>{e.mode="single",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="none");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),T(),i(t.settingsPanel)});t.melodyModeBtn.addEventListener("click",()=>{e.mode="melody",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="flex");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),T(),i(t.settingsPanel)});t.backBtn.addEventListener("click",()=>{i(t.modeSelection)});t.startGameBtn.addEventListener("click",()=>{e.level==="adult"&&(e.settings.octaveRange=t.octaveRange.value,e.settings.melodyLength=parseInt(t.melodyLength.value),e.settings.includeSharps=t.includeSharps.checked),w(),N()});t.playBtn.addEventListener("click",async()=>{t.playBtn.disabled=!0,await _(),t.playBtn.disabled=!1});t.modalNextBtn.addEventListener("click",()=>{B(),h()});t.wrongModalNextBtn.addEventListener("click",()=>{B(),h()});t.quitBtn.addEventListener("click",()=>{B(),W()});t.retryBtn.addEventListener("click",()=>{N()});t.homeBtn.addEventListener("click",()=>{i(t.levelSelection)});i(t.levelSelection);
