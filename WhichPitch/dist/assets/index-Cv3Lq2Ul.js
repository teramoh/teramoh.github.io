(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function c(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(l){if(l.ep)return;l.ep=!0;const r=c(l);fetch(l.href,r)}})();let a=null;const O={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88};function V(n,o){const c=O[n],s=o-4;return c*Math.pow(2,s)}function T(){return a||(a=new(window.AudioContext||window.webkitAudioContext)),a}async function P(){a&&a.state==="suspended"&&await a.resume()}function B(n,o,c=1.2){return new Promise(s=>{T(),P();const l=V(n,o),r=a.currentTime,d=a.createGain();d.gain.setValueAtTime(.7,r),d.connect(a.destination),[{ratio:1,amplitude:1},{ratio:2,amplitude:.5},{ratio:3,amplitude:.25},{ratio:4,amplitude:.15},{ratio:5,amplitude:.08},{ratio:6,amplitude:.05}].forEach((u,ne)=>{const y=a.createOscillator(),m=a.createGain();y.type="sine",y.frequency.setValueAtTime(l*u.ratio,r);const b=.005,Q=.4,K=u.amplitude*.3;m.gain.setValueAtTime(0,r),m.gain.linearRampToValueAtTime(u.amplitude,r+b),m.gain.exponentialRampToValueAtTime(Math.max(K,.001),r+b+Q),m.gain.exponentialRampToValueAtTime(.001,r+c),y.connect(m),m.connect(d),y.start(r),y.stop(r+c+.1)});const L=a.createBuffer(1,a.sampleRate*.05,a.sampleRate),A=L.getChannelData(0);for(let u=0;u<A.length;u++)A[u]=(Math.random()*2-1)*Math.exp(-u/(a.sampleRate*.01));const p=a.createBufferSource();p.buffer=L;const h=a.createGain();h.gain.setValueAtTime(.08,r),h.gain.exponentialRampToValueAtTime(.001,r+.05);const v=a.createBiquadFilter();v.type="highpass",v.frequency.setValueAtTime(l*2,r),p.connect(v),v.connect(h),h.connect(d),p.start(r),p.stop(r+.05),setTimeout(()=>{s()},c*1e3)})}async function $(n,o=.6,c=.15){for(const s of n)await B(s.note,s.octave,o),await new Promise(l=>setTimeout(l,c*1e3))}const S=["C","D","E","F","G","A","B"],_=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],x={kindergarten:{name:"ã‚ˆã†ã¡ãˆã‚“",notes:["C","D","E","F","G","A","B"],octaves:[4],includeSharps:!1,melodyLength:3,description:"ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚· ã ã‘ã§ã‚Œã‚“ã—ã‚…ã†ï¼"},elementary:{name:"å°å­¦ç”Ÿ",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[4],includeSharps:!0,melodyLength:4,description:"ç™½ã„éµç›¤ã¨é»’ã„éµç›¤ã‚’ã¤ã‹ã£ã¦ç·´ç¿’ï¼"},adult:{name:"å¤§äºº",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[3,4,5],includeSharps:!0,melodyLength:5,description:"å…¨éŸ³åŸŸã§ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼è©³ç´°è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚"}},j={C:"ãƒ‰","C#":"ãƒ‰â™¯",D:"ãƒ¬","D#":"ãƒ¬â™¯",E:"ãƒŸ",F:"ãƒ•ã‚¡","F#":"ãƒ•ã‚¡â™¯",G:"ã‚½","G#":"ã‚½â™¯",A:"ãƒ©","A#":"ãƒ©â™¯",B:"ã‚·"};let e={level:null,mode:null,settings:{octaveRange:"4",melodyLength:4,includeSharps:!0},currentQuestion:null,currentMelodyIndex:0,userAnswers:[],score:{correct:0,total:0,streak:0,maxStreak:0},isAnswered:!1};const t={levelSelection:document.getElementById("level-selection"),modeSelection:document.getElementById("mode-selection"),settingsPanel:document.getElementById("settings-panel"),gamePanel:document.getElementById("game-panel"),resultPanel:document.getElementById("result-panel"),kindergartenBtn:document.getElementById("kindergarten-btn"),elementaryBtn:document.getElementById("elementary-btn"),adultBtn:document.getElementById("adult-btn"),backToLevelBtn:document.getElementById("back-to-level-btn"),modeTitle:document.getElementById("mode-title"),singleModeBtn:document.getElementById("single-mode-btn"),melodyModeBtn:document.getElementById("melody-mode-btn"),settingsTitle:document.getElementById("settings-title"),levelInfo:document.getElementById("level-info"),octaveRange:document.getElementById("octave-range"),melodyLength:document.getElementById("melody-length"),includeSharps:document.getElementById("include-sharps"),startGameBtn:document.getElementById("start-game-btn"),backBtn:document.getElementById("back-btn"),correctCount:document.getElementById("correct-count"),totalCount:document.getElementById("total-count"),streakCount:document.getElementById("streak-count"),playBtn:document.getElementById("play-btn"),melodyProgress:document.getElementById("melody-progress"),currentNoteIndex:document.getElementById("current-note-index"),totalNotes:document.getElementById("total-notes"),pianoKeys:document.getElementById("piano-keys"),quitBtn:document.getElementById("quit-btn"),finalPercentage:document.getElementById("final-percentage"),finalCorrect:document.getElementById("final-correct"),finalTotal:document.getElementById("final-total"),maxStreak:document.getElementById("max-streak"),retryBtn:document.getElementById("retry-btn"),homeBtn:document.getElementById("home-btn"),correctModal:document.getElementById("correct-modal"),modalAnswer:document.getElementById("modal-answer"),modalStreak:document.getElementById("modal-streak"),modalNextBtn:document.getElementById("modal-next-btn"),wrongModal:document.getElementById("wrong-modal"),wrongModalAnswer:document.getElementById("wrong-modal-answer"),wrongModalNextBtn:document.getElementById("wrong-modal-next-btn")};function i(n){[t.levelSelection,t.modeSelection,t.settingsPanel,t.gamePanel,t.resultPanel].forEach(o=>o.classList.add("hidden")),n.classList.remove("hidden")}function g(n){return(e.level==="kindergarten"||e.level==="elementary")&&j[n]||n}function H(){t.pianoKeys.innerHTML="";const n=document.createElement("div");if(n.style.display="flex",n.style.position="relative",S.forEach((o,c)=>{const s=document.createElement("button");s.className="white-key",s.dataset.note=o,s.textContent=g(o),s.addEventListener("click",()=>M(o)),n.appendChild(s)}),e.settings.includeSharps){const o=[0,1,3,4,5],c=["C#","D#","F#","G#","A#"];o.forEach((s,l)=>{const r=document.createElement("button");r.className="black-key",r.dataset.note=c[l],r.textContent=g(c[l]),r.style.left=`${s*49+32}px`,r.addEventListener("click",()=>M(c[l])),n.appendChild(r)})}t.pianoKeys.appendChild(n)}function U(){const n=x[e.level];return e.level==="adult"?e.settings.includeSharps?_:S:e.settings.includeSharps?n.notes:S}function W(){if(e.level==="adult"){const n=e.settings.octaveRange;return n==="3-5"?[3,4,5]:[parseInt(n)]}return x[e.level].octaves}function N(){const n=U(),o=W(),c=n[Math.floor(Math.random()*n.length)],s=o[Math.floor(Math.random()*o.length)];return{note:c,octave:s}}function J(n){const o=[];for(let c=0;c<n;c++)o.push(N());return o}function I(){e.isAnswered=!1,e.userAnswers=[],e.currentMelodyIndex=0,document.querySelectorAll(".white-key, .black-key").forEach(n=>{n.classList.remove("correct","wrong")}),k(),e.mode==="single"?e.currentQuestion=N():(e.currentQuestion=J(e.settings.melodyLength),t.totalNotes.textContent=e.settings.melodyLength,t.currentNoteIndex.textContent="1"),q()}function q(){e.mode==="melody"?(t.melodyProgress.classList.remove("hidden"),t.currentNoteIndex.textContent=e.currentMelodyIndex+1):t.melodyProgress.classList.add("hidden")}async function z(){if(await P(),e.mode==="single"){const{note:n,octave:o}=e.currentQuestion;await B(n,o)}else await $(e.currentQuestion)}function M(n){e.isAnswered&&e.mode==="single"||(e.mode==="single"?X(n):Y(n))}function X(n){e.isAnswered=!0,e.score.total++;const o=e.currentQuestion.note,c=n===o;c?(e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak)):e.score.streak=0,E(),Z(n,o,c);const s=e.currentQuestion.octave;B(n,s,.5),c?G(g(o)):F(g(o))}function Y(n){const o=e.currentMelodyIndex,c=e.currentQuestion[o].note,s=n===c;e.userAnswers.push(n);const l=document.querySelector(`[data-note="${n}"]`);l&&(l.classList.add(s?"correct":"wrong"),setTimeout(()=>l.classList.remove("correct","wrong"),300));const r=e.currentQuestion[o].octave;if(B(n,r,.3),!s){e.isAnswered=!0,e.score.total++,e.score.streak=0;const d=e.currentQuestion.map(f=>g(f.note)).join(" â†’ ");F(d),E();return}if(e.currentMelodyIndex++,q(),e.currentMelodyIndex>=e.currentQuestion.length){e.isAnswered=!0,e.score.total++,e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak),E();const d=e.currentQuestion.map(f=>g(f.note)).join(" â†’ ");G(d)}}function Z(n,o,c){const s=document.querySelector(`[data-note="${n}"]`),l=document.querySelector(`[data-note="${o}"]`);s&&s.classList.add(c?"correct":"wrong"),!c&&l&&l.classList.add("correct")}function E(){t.correctCount.textContent=e.score.correct,t.totalCount.textContent=e.score.total,t.streakCount.textContent=e.score.streak}function G(n){const o=e.level==="kindergarten"||e.level==="elementary";t.modalAnswer.textContent=n,t.modalStreak.textContent=e.score.streak,t.modalNextBtn.textContent=o?"âœ¨ ã¤ãŽã®ã‚‚ã‚“ã ã„ âœ¨":"âœ¨ æ¬¡ã®å•é¡Œ âœ¨",t.correctModal.classList.remove("hidden")}function F(n){const o=e.level==="kindergarten"||e.level==="elementary";t.wrongModalAnswer.textContent=n,t.wrongModalNextBtn.textContent=o?"âœ¨ ã¤ãŽã®ã‚‚ã‚“ã ã„ âœ¨":"âœ¨ æ¬¡ã®å•é¡Œ âœ¨",t.wrongModal.classList.remove("hidden")}function k(){t.correctModal.classList.add("hidden"),t.wrongModal.classList.add("hidden")}function ee(){const n=e.score.total>0?Math.round(e.score.correct/e.score.total*100):0;t.finalPercentage.textContent=n,t.finalCorrect.textContent=e.score.correct,t.finalTotal.textContent=e.score.total,t.maxStreak.textContent=e.score.maxStreak,i(t.resultPanel)}function te(){e.score={correct:0,total:0,streak:0,maxStreak:0},e.currentQuestion=null,e.currentMelodyIndex=0,e.userAnswers=[],e.isAnswered=!1}function w(n){e.level=n;const o=x[n];e.settings.includeSharps=o.includeSharps,e.settings.melodyLength=o.melodyLength,e.settings.octaveRange=o.octaves.length>1?"3-5":String(o.octaves[0]),t.includeSharps.checked=o.includeSharps,t.melodyLength.value=String(o.melodyLength),t.octaveRange.value=e.settings.octaveRange}function R(){const n=x[e.level];t.levelInfo.innerHTML=`
    <span class="level-badge ${e.level}">${n.name}</span>
    <p>${n.description}</p>
  `}function C(){e.level==="kindergarten"?(t.modeTitle.textContent="ðŸŒ¸ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­ï¼ ðŸŒ¸",document.querySelector("#single-mode-btn .mode-title").textContent="ãŸã‚“ãŠã‚“ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®ãŠã¨ã‚’ã‚ã¦ã‚ˆã† ðŸŽµ",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="ãŠã¨ã‚’ã˜ã‚…ã‚“ã°ã‚“ã«ã‚ã¦ã‚ˆã† ðŸŽ¶"):(t.modeTitle.textContent="ðŸŽ€ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ ðŸŽ€",document.querySelector("#single-mode-btn .mode-title").textContent="å˜éŸ³ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®éŸ³ã‚’è´ã„ã¦å½“ã¦ã‚‹",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="è¤‡æ•°ã®éŸ³ã‚’é †ç•ªã«å½“ã¦ã‚‹")}function D(){te(),H(),E(),I(),i(t.gamePanel)}t.kindergartenBtn.addEventListener("click",()=>{w("kindergarten"),C(),i(t.modeSelection)});t.elementaryBtn.addEventListener("click",()=>{w("elementary"),C(),i(t.modeSelection)});t.adultBtn.addEventListener("click",()=>{w("adult"),C(),i(t.modeSelection)});t.backToLevelBtn.addEventListener("click",()=>{i(t.levelSelection)});t.singleModeBtn.addEventListener("click",()=>{e.mode="single",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="none");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),R(),i(t.settingsPanel)});t.melodyModeBtn.addEventListener("click",()=>{e.mode="melody",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="flex");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),R(),i(t.settingsPanel)});t.backBtn.addEventListener("click",()=>{i(t.modeSelection)});t.startGameBtn.addEventListener("click",()=>{e.level==="adult"&&(e.settings.octaveRange=t.octaveRange.value,e.settings.melodyLength=parseInt(t.melodyLength.value),e.settings.includeSharps=t.includeSharps.checked),T(),D()});t.playBtn.addEventListener("click",async()=>{t.playBtn.disabled=!0,await z(),t.playBtn.disabled=!1});t.modalNextBtn.addEventListener("click",()=>{k(),I()});t.wrongModalNextBtn.addEventListener("click",()=>{k(),I()});t.quitBtn.addEventListener("click",()=>{k(),ee()});t.retryBtn.addEventListener("click",()=>{D()});t.homeBtn.addEventListener("click",()=>{i(t.levelSelection)});i(t.levelSelection);
