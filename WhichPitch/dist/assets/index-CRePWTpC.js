(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();let a=null;const q={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88};function N(n,o){const s=q[n],l=o-4;return s*Math.pow(2,l)}function I(){return a||(a=new(window.AudioContext||window.webkitAudioContext)),a}async function L(){a&&a.state==="suspended"&&await a.resume()}function f(n,o,s=.8){return new Promise(l=>{I(),L();const r=N(n,o),c=a.createOscillator(),d=a.createGain();c.type="sine",c.frequency.setValueAtTime(r,a.currentTime);const m=a.createOscillator();m.type="triangle",m.frequency.setValueAtTime(r*2,a.currentTime);const v=a.createGain();v.gain.setValueAtTime(.15,a.currentTime);const u=a.currentTime,k=.02,P=.1,M=.5;d.gain.setValueAtTime(0,u),d.gain.linearRampToValueAtTime(.5,u+k),d.gain.linearRampToValueAtTime(M*.5,u+k+P),d.gain.linearRampToValueAtTime(0,u+s),c.connect(d),m.connect(v),v.connect(d),d.connect(a.destination),c.start(u),m.start(u),c.stop(u+s),m.stop(u+s),setTimeout(()=>{l()},s*1e3)})}async function D(n,o=.6,s=.15){for(const l of n)await f(l.note,l.octave,o),await new Promise(r=>setTimeout(r,s*1e3))}const h=["C","D","E","F","G","A","B"],G=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],p={kindergarten:{name:"ã‚ˆã†ã¡ãˆã‚“",notes:["C","D","E","F","G","A","B"],octaves:[4],includeSharps:!1,melodyLength:3,description:"ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚· ã ã‘ã§ã‚Œã‚“ã—ã‚…ã†ï¼"},elementary:{name:"å°å­¦ç”Ÿ",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[4],includeSharps:!0,melodyLength:4,description:"ç™½ã„éµç›¤ã¨é»’ã„éµç›¤ã‚’ã¤ã‹ã£ã¦ç·´ç¿’ï¼"},adult:{name:"å¤§äºº",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[3,4,5],includeSharps:!0,melodyLength:5,description:"å…¨éŸ³åŸŸã§ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼è©³ç´°è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚"}},F={C:"ãƒ‰","C#":"ãƒ‰â™¯",D:"ãƒ¬","D#":"ãƒ¬â™¯",E:"ãƒŸ",F:"ãƒ•ã‚¡","F#":"ãƒ•ã‚¡â™¯",G:"ã‚½","G#":"ã‚½â™¯",A:"ãƒ©","A#":"ãƒ©â™¯",B:"ã‚·"};let e={level:null,mode:null,settings:{octaveRange:"4",melodyLength:4,includeSharps:!0},currentQuestion:null,currentMelodyIndex:0,userAnswers:[],score:{correct:0,total:0,streak:0,maxStreak:0},isAnswered:!1};const t={levelSelection:document.getElementById("level-selection"),modeSelection:document.getElementById("mode-selection"),settingsPanel:document.getElementById("settings-panel"),gamePanel:document.getElementById("game-panel"),resultPanel:document.getElementById("result-panel"),kindergartenBtn:document.getElementById("kindergarten-btn"),elementaryBtn:document.getElementById("elementary-btn"),adultBtn:document.getElementById("adult-btn"),backToLevelBtn:document.getElementById("back-to-level-btn"),modeTitle:document.getElementById("mode-title"),singleModeBtn:document.getElementById("single-mode-btn"),melodyModeBtn:document.getElementById("melody-mode-btn"),settingsTitle:document.getElementById("settings-title"),levelInfo:document.getElementById("level-info"),octaveRange:document.getElementById("octave-range"),melodyLength:document.getElementById("melody-length"),includeSharps:document.getElementById("include-sharps"),startGameBtn:document.getElementById("start-game-btn"),backBtn:document.getElementById("back-btn"),correctCount:document.getElementById("correct-count"),totalCount:document.getElementById("total-count"),streakCount:document.getElementById("streak-count"),playBtn:document.getElementById("play-btn"),melodyProgress:document.getElementById("melody-progress"),currentNoteIndex:document.getElementById("current-note-index"),totalNotes:document.getElementById("total-notes"),pianoKeys:document.getElementById("piano-keys"),resultDisplay:document.getElementById("result-display"),resultIcon:document.getElementById("result-icon"),resultText:document.getElementById("result-text"),nextBtn:document.getElementById("next-btn"),quitBtn:document.getElementById("quit-btn"),finalPercentage:document.getElementById("final-percentage"),finalCorrect:document.getElementById("final-correct"),finalTotal:document.getElementById("final-total"),maxStreak:document.getElementById("max-streak"),retryBtn:document.getElementById("retry-btn"),homeBtn:document.getElementById("home-btn")};function i(n){[t.levelSelection,t.modeSelection,t.settingsPanel,t.gamePanel,t.resultPanel].forEach(o=>o.classList.add("hidden")),n.classList.remove("hidden")}function y(n){return(e.level==="kindergarten"||e.level==="elementary")&&F[n]||n}function R(){t.pianoKeys.innerHTML="";const n=document.createElement("div");if(n.style.display="flex",n.style.position="relative",h.forEach((o,s)=>{const l=document.createElement("button");l.className="white-key",l.dataset.note=o,l.textContent=y(o),l.addEventListener("click",()=>S(o)),n.appendChild(l)}),e.settings.includeSharps){const o=[0,1,3,4,5],s=["C#","D#","F#","G#","A#"];o.forEach((l,r)=>{const c=document.createElement("button");c.className="black-key",c.dataset.note=s[r],c.textContent=y(s[r]),c.style.left=`${l*49+32}px`,c.addEventListener("click",()=>S(s[r])),n.appendChild(c)})}t.pianoKeys.appendChild(n)}function Q(){const n=p[e.level];return e.level==="adult"?e.settings.includeSharps?G:h:e.settings.includeSharps?n.notes:h}function O(){if(e.level==="adult"){const n=e.settings.octaveRange;return n==="3-5"?[3,4,5]:[parseInt(n)]}return p[e.level].octaves}function C(){const n=Q(),o=O(),s=n[Math.floor(Math.random()*n.length)],l=o[Math.floor(Math.random()*o.length)];return{note:s,octave:l}}function K(n){const o=[];for(let s=0;s<n;s++)o.push(C());return o}function A(){e.isAnswered=!1,e.userAnswers=[],e.currentMelodyIndex=0,document.querySelectorAll(".white-key, .black-key").forEach(n=>{n.classList.remove("correct","wrong")}),t.resultDisplay.classList.add("hidden"),t.nextBtn.classList.add("hidden"),e.mode==="single"?e.currentQuestion=C():(e.currentQuestion=K(e.settings.melodyLength),t.totalNotes.textContent=e.settings.melodyLength,t.currentNoteIndex.textContent="1"),b()}function b(){e.mode==="melody"?(t.melodyProgress.classList.remove("hidden"),t.currentNoteIndex.textContent=e.currentMelodyIndex+1):t.melodyProgress.classList.add("hidden")}async function $(){if(await L(),e.mode==="single"){const{note:n,octave:o}=e.currentQuestion;await f(n,o)}else await D(e.currentQuestion)}function S(n){e.isAnswered&&e.mode==="single"||(e.mode==="single"?V(n):_(n))}function V(n){e.isAnswered=!0,e.score.total++;const o=e.currentQuestion.note,s=n===o;s?(e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak)):e.score.streak=0,g(),E(s,y(o)),j(n,o,s),t.nextBtn.classList.remove("hidden");const l=e.currentQuestion.octave;f(n,l,.5)}function _(n){const o=e.currentMelodyIndex,s=e.currentQuestion[o].note,l=n===s;e.userAnswers.push(n);const r=document.querySelector(`[data-note="${n}"]`);r&&(r.classList.add(l?"correct":"wrong"),setTimeout(()=>r.classList.remove("correct","wrong"),300));const c=e.currentQuestion[o].octave;if(f(n,c,.3),!l){e.isAnswered=!0,e.score.total++,e.score.streak=0;const d=e.currentQuestion.map(m=>y(m.note)).join(" â†’ ");E(!1,d),t.nextBtn.classList.remove("hidden"),g();return}e.currentMelodyIndex++,b(),e.currentMelodyIndex>=e.currentQuestion.length&&(e.isAnswered=!0,e.score.total++,e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak),E(!0),t.nextBtn.classList.remove("hidden"),g())}function E(n,o=null){t.resultDisplay.classList.remove("hidden","correct","wrong"),t.resultDisplay.classList.add(n?"correct":"wrong");const s=e.level==="kindergarten"||e.level==="elementary";if(n)t.resultIcon.textContent="âœ“",t.resultText.textContent=s?"ã›ã„ã‹ã„ï¼ðŸŽ‰":"æ­£è§£ï¼";else{t.resultIcon.textContent="âœ—";let l=o;s&&o&&(l=o.split(" â†’ ").map(r=>y(r)).join(" â†’ ")),t.resultText.textContent=s?`ã–ã‚“ã­ã‚“... ã“ãŸãˆã¯ ${l}`:`ä¸æ­£è§£... æ­£è§£ã¯ ${l}`}}function j(n,o,s){const l=document.querySelector(`[data-note="${n}"]`),r=document.querySelector(`[data-note="${o}"]`);l&&l.classList.add(s?"correct":"wrong"),!s&&r&&r.classList.add("correct")}function g(){t.correctCount.textContent=e.score.correct,t.totalCount.textContent=e.score.total,t.streakCount.textContent=e.score.streak}function H(){const n=e.score.total>0?Math.round(e.score.correct/e.score.total*100):0;t.finalPercentage.textContent=n,t.finalCorrect.textContent=e.score.correct,t.finalTotal.textContent=e.score.total,t.maxStreak.textContent=e.score.maxStreak,i(t.resultPanel)}function U(){e.score={correct:0,total:0,streak:0,maxStreak:0},e.currentQuestion=null,e.currentMelodyIndex=0,e.userAnswers=[],e.isAnswered=!1}function B(n){e.level=n;const o=p[n];e.settings.includeSharps=o.includeSharps,e.settings.melodyLength=o.melodyLength,e.settings.octaveRange=o.octaves.length>1?"3-5":String(o.octaves[0]),t.includeSharps.checked=o.includeSharps,t.melodyLength.value=String(o.melodyLength),t.octaveRange.value=e.settings.octaveRange}function w(){const n=p[e.level];t.levelInfo.innerHTML=`
    <span class="level-badge ${e.level}">${n.name}</span>
    <p>${n.description}</p>
  `}function x(){e.level==="kindergarten"?(t.modeTitle.textContent="ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­ï¼",document.querySelector("#single-mode-btn .mode-title").textContent="ãŸã‚“ãŠã‚“ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®ãŠã¨ã‚’ã‚ã¦ã‚ˆã†",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="ãŠã¨ã‚’ã˜ã‚…ã‚“ã°ã‚“ã«ã‚ã¦ã‚ˆã†"):(t.modeTitle.textContent="ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠž",document.querySelector("#single-mode-btn .mode-title").textContent="å˜éŸ³ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®éŸ³ã‚’è´ã„ã¦å½“ã¦ã‚‹",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="è¤‡æ•°ã®éŸ³ã‚’é †ç•ªã«å½“ã¦ã‚‹")}function T(){U(),R(),g(),A(),i(t.gamePanel)}t.kindergartenBtn.addEventListener("click",()=>{B("kindergarten"),x(),i(t.modeSelection)});t.elementaryBtn.addEventListener("click",()=>{B("elementary"),x(),i(t.modeSelection)});t.adultBtn.addEventListener("click",()=>{B("adult"),x(),i(t.modeSelection)});t.backToLevelBtn.addEventListener("click",()=>{i(t.levelSelection)});t.singleModeBtn.addEventListener("click",()=>{e.mode="single",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="none");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),w(),i(t.settingsPanel)});t.melodyModeBtn.addEventListener("click",()=>{e.mode="melody",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="flex");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),w(),i(t.settingsPanel)});t.backBtn.addEventListener("click",()=>{i(t.modeSelection)});t.startGameBtn.addEventListener("click",()=>{e.level==="adult"&&(e.settings.octaveRange=t.octaveRange.value,e.settings.melodyLength=parseInt(t.melodyLength.value),e.settings.includeSharps=t.includeSharps.checked),I(),T()});t.playBtn.addEventListener("click",async()=>{t.playBtn.disabled=!0,await $(),t.playBtn.disabled=!1});t.nextBtn.addEventListener("click",()=>{A()});t.quitBtn.addEventListener("click",()=>{H()});t.retryBtn.addEventListener("click",()=>{T()});t.homeBtn.addEventListener("click",()=>{i(t.levelSelection)});i(t.levelSelection);
