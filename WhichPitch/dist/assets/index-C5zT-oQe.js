(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function l(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=l(r);fetch(r.href,c)}})();let d=null;const D={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88};function G(n,o){const l=D[n],s=o-4;return l*Math.pow(2,s)}function I(){return d||(d=new(window.AudioContext||window.webkitAudioContext)),d}async function L(){d&&d.state==="suspended"&&await d.resume()}function f(n,o,l=.8){return new Promise(s=>{I(),L();const r=G(n,o),c=d.createOscillator(),a=d.createGain();c.type="sine",c.frequency.setValueAtTime(r,d.currentTime);const u=d.createOscillator();u.type="triangle",u.frequency.setValueAtTime(r*2,d.currentTime);const v=d.createGain();v.gain.setValueAtTime(.15,d.currentTime);const m=d.currentTime,k=.02,N=.1,q=.5;a.gain.setValueAtTime(0,m),a.gain.linearRampToValueAtTime(.5,m+k),a.gain.linearRampToValueAtTime(q*.5,m+k+N),a.gain.linearRampToValueAtTime(0,m+l),c.connect(a),u.connect(v),v.connect(a),a.connect(d.destination),c.start(m),u.start(m),c.stop(m+l),u.stop(m+l),setTimeout(()=>{s()},l*1e3)})}async function F(n,o=.6,l=.15){for(const s of n)await f(s.note,s.octave,o),await new Promise(r=>setTimeout(r,l*1e3))}const E=["C","D","E","F","G","A","B"],Q=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],p={kindergarten:{name:"ã‚ˆã†ã¡ãˆã‚“",notes:["C","D","E","F","G","A","B"],octaves:[4],includeSharps:!1,melodyLength:3,description:"ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚· ã ã‘ã§ã‚Œã‚“ã—ã‚…ã†ï¼"},elementary:{name:"å°å­¦ç”Ÿ",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[4],includeSharps:!0,melodyLength:4,description:"ç™½ã„éµç›¤ã¨é»’ã„éµç›¤ã‚’ã¤ã‹ã£ã¦ç·´ç¿’ï¼"},adult:{name:"å¤§äºº",notes:["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"],octaves:[3,4,5],includeSharps:!0,melodyLength:5,description:"å…¨éŸ³åŸŸã§ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼è©³ç´°è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚"}},R={C:"ãƒ‰","C#":"ãƒ‰â™¯",D:"ãƒ¬","D#":"ãƒ¬â™¯",E:"ãƒŸ",F:"ãƒ•ã‚¡","F#":"ãƒ•ã‚¡â™¯",G:"ã‚½","G#":"ã‚½â™¯",A:"ãƒ©","A#":"ãƒ©â™¯",B:"ã‚·"};let e={level:null,mode:null,settings:{octaveRange:"4",melodyLength:4,includeSharps:!0},currentQuestion:null,currentMelodyIndex:0,userAnswers:[],score:{correct:0,total:0,streak:0,maxStreak:0},isAnswered:!1};const t={levelSelection:document.getElementById("level-selection"),modeSelection:document.getElementById("mode-selection"),settingsPanel:document.getElementById("settings-panel"),gamePanel:document.getElementById("game-panel"),resultPanel:document.getElementById("result-panel"),kindergartenBtn:document.getElementById("kindergarten-btn"),elementaryBtn:document.getElementById("elementary-btn"),adultBtn:document.getElementById("adult-btn"),backToLevelBtn:document.getElementById("back-to-level-btn"),modeTitle:document.getElementById("mode-title"),singleModeBtn:document.getElementById("single-mode-btn"),melodyModeBtn:document.getElementById("melody-mode-btn"),settingsTitle:document.getElementById("settings-title"),levelInfo:document.getElementById("level-info"),octaveRange:document.getElementById("octave-range"),melodyLength:document.getElementById("melody-length"),includeSharps:document.getElementById("include-sharps"),startGameBtn:document.getElementById("start-game-btn"),backBtn:document.getElementById("back-btn"),correctCount:document.getElementById("correct-count"),totalCount:document.getElementById("total-count"),streakCount:document.getElementById("streak-count"),playBtn:document.getElementById("play-btn"),melodyProgress:document.getElementById("melody-progress"),currentNoteIndex:document.getElementById("current-note-index"),totalNotes:document.getElementById("total-notes"),pianoKeys:document.getElementById("piano-keys"),resultDisplay:document.getElementById("result-display"),resultIcon:document.getElementById("result-icon"),resultText:document.getElementById("result-text"),nextBtn:document.getElementById("next-btn"),quitBtn:document.getElementById("quit-btn"),finalPercentage:document.getElementById("final-percentage"),finalCorrect:document.getElementById("final-correct"),finalTotal:document.getElementById("final-total"),maxStreak:document.getElementById("max-streak"),retryBtn:document.getElementById("retry-btn"),homeBtn:document.getElementById("home-btn"),correctModal:document.getElementById("correct-modal"),modalAnswer:document.getElementById("modal-answer"),modalStreak:document.getElementById("modal-streak"),modalNextBtn:document.getElementById("modal-next-btn")};function i(n){[t.levelSelection,t.modeSelection,t.settingsPanel,t.gamePanel,t.resultPanel].forEach(o=>o.classList.add("hidden")),n.classList.remove("hidden")}function y(n){return(e.level==="kindergarten"||e.level==="elementary")&&R[n]||n}function O(){t.pianoKeys.innerHTML="";const n=document.createElement("div");if(n.style.display="flex",n.style.position="relative",E.forEach((o,l)=>{const s=document.createElement("button");s.className="white-key",s.dataset.note=o,s.textContent=y(o),s.addEventListener("click",()=>S(o)),n.appendChild(s)}),e.settings.includeSharps){const o=[0,1,3,4,5],l=["C#","D#","F#","G#","A#"];o.forEach((s,r)=>{const c=document.createElement("button");c.className="black-key",c.dataset.note=l[r],c.textContent=y(l[r]),c.style.left=`${s*49+32}px`,c.addEventListener("click",()=>S(l[r])),n.appendChild(c)})}t.pianoKeys.appendChild(n)}function K(){const n=p[e.level];return e.level==="adult"?e.settings.includeSharps?Q:E:e.settings.includeSharps?n.notes:E}function $(){if(e.level==="adult"){const n=e.settings.octaveRange;return n==="3-5"?[3,4,5]:[parseInt(n)]}return p[e.level].octaves}function C(){const n=K(),o=$(),l=n[Math.floor(Math.random()*n.length)],s=o[Math.floor(Math.random()*o.length)];return{note:l,octave:s}}function V(n){const o=[];for(let l=0;l<n;l++)o.push(C());return o}function h(){e.isAnswered=!1,e.userAnswers=[],e.currentMelodyIndex=0,document.querySelectorAll(".white-key, .black-key").forEach(n=>{n.classList.remove("correct","wrong")}),t.resultDisplay.classList.add("hidden"),t.nextBtn.classList.add("hidden"),e.mode==="single"?e.currentQuestion=C():(e.currentQuestion=V(e.settings.melodyLength),t.totalNotes.textContent=e.settings.melodyLength,t.currentNoteIndex.textContent="1"),A()}function A(){e.mode==="melody"?(t.melodyProgress.classList.remove("hidden"),t.currentNoteIndex.textContent=e.currentMelodyIndex+1):t.melodyProgress.classList.add("hidden")}async function _(){if(await L(),e.mode==="single"){const{note:n,octave:o}=e.currentQuestion;await f(n,o)}else await F(e.currentQuestion)}function S(n){e.isAnswered&&e.mode==="single"||(e.mode==="single"?j(n):H(n))}function j(n){e.isAnswered=!0,e.score.total++;const o=e.currentQuestion.note,l=n===o;l?(e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak)):e.score.streak=0,g(),U(n,o,l);const s=e.currentQuestion.octave;f(n,s,.5),l?b(y(o)):(w(!1,y(o)),t.nextBtn.classList.remove("hidden"))}function H(n){const o=e.currentMelodyIndex,l=e.currentQuestion[o].note,s=n===l;e.userAnswers.push(n);const r=document.querySelector(`[data-note="${n}"]`);r&&(r.classList.add(s?"correct":"wrong"),setTimeout(()=>r.classList.remove("correct","wrong"),300));const c=e.currentQuestion[o].octave;if(f(n,c,.3),!s){e.isAnswered=!0,e.score.total++,e.score.streak=0;const a=e.currentQuestion.map(u=>y(u.note)).join(" â†’ ");w(!1,a),t.nextBtn.classList.remove("hidden"),g();return}if(e.currentMelodyIndex++,A(),e.currentMelodyIndex>=e.currentQuestion.length){e.isAnswered=!0,e.score.total++,e.score.correct++,e.score.streak++,e.score.streak>e.score.maxStreak&&(e.score.maxStreak=e.score.streak),g();const a=e.currentQuestion.map(u=>y(u.note)).join(" â†’ ");b(a)}}function w(n,o=null){t.resultDisplay.classList.remove("hidden","correct","wrong"),t.resultDisplay.classList.add("wrong");const l=e.level==="kindergarten"||e.level==="elementary";{t.resultIcon.textContent="ðŸ’¦";let s=o;l&&o&&(s=o.split(" â†’ ").map(r=>y(r)).join(" â†’ ")),t.resultText.textContent=l?`ãŠã—ã„ï¼ã“ãŸãˆã¯ ${s} ã ã‚ˆ ðŸŒˆ`:`ä¸æ­£è§£... æ­£è§£ã¯ ${s}`}}function U(n,o,l){const s=document.querySelector(`[data-note="${n}"]`),r=document.querySelector(`[data-note="${o}"]`);s&&s.classList.add(l?"correct":"wrong"),!l&&r&&r.classList.add("correct")}function g(){t.correctCount.textContent=e.score.correct,t.totalCount.textContent=e.score.total,t.streakCount.textContent=e.score.streak}function b(n){const o=e.level==="kindergarten"||e.level==="elementary";t.modalAnswer.textContent=n,t.modalStreak.textContent=e.score.streak,t.modalNextBtn.textContent=o?"âœ¨ ã¤ãŽã®ã‚‚ã‚“ã ã„ âœ¨":"âœ¨ æ¬¡ã®å•é¡Œ âœ¨",t.correctModal.classList.remove("hidden")}function T(){t.correctModal.classList.add("hidden")}function J(){const n=e.score.total>0?Math.round(e.score.correct/e.score.total*100):0;t.finalPercentage.textContent=n,t.finalCorrect.textContent=e.score.correct,t.finalTotal.textContent=e.score.total,t.maxStreak.textContent=e.score.maxStreak,i(t.resultPanel)}function W(){e.score={correct:0,total:0,streak:0,maxStreak:0},e.currentQuestion=null,e.currentMelodyIndex=0,e.userAnswers=[],e.isAnswered=!1}function B(n){e.level=n;const o=p[n];e.settings.includeSharps=o.includeSharps,e.settings.melodyLength=o.melodyLength,e.settings.octaveRange=o.octaves.length>1?"3-5":String(o.octaves[0]),t.includeSharps.checked=o.includeSharps,t.melodyLength.value=String(o.melodyLength),t.octaveRange.value=e.settings.octaveRange}function M(){const n=p[e.level];t.levelInfo.innerHTML=`
    <span class="level-badge ${e.level}">${n.name}</span>
    <p>${n.description}</p>
  `}function x(){e.level==="kindergarten"?(t.modeTitle.textContent="ðŸŒ¸ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­ï¼ ðŸŒ¸",document.querySelector("#single-mode-btn .mode-title").textContent="ãŸã‚“ãŠã‚“ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®ãŠã¨ã‚’ã‚ã¦ã‚ˆã† ðŸŽµ",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="ãŠã¨ã‚’ã˜ã‚…ã‚“ã°ã‚“ã«ã‚ã¦ã‚ˆã† ðŸŽ¶"):(t.modeTitle.textContent="ðŸŽ€ ã‚Œã‚“ã—ã‚…ã†ãƒ¢ãƒ¼ãƒ‰ ðŸŽ€",document.querySelector("#single-mode-btn .mode-title").textContent="å˜éŸ³ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#single-mode-btn .mode-desc").textContent="1ã¤ã®éŸ³ã‚’è´ã„ã¦å½“ã¦ã‚‹",document.querySelector("#melody-mode-btn .mode-title").textContent="ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰",document.querySelector("#melody-mode-btn .mode-desc").textContent="è¤‡æ•°ã®éŸ³ã‚’é †ç•ªã«å½“ã¦ã‚‹")}function P(){W(),O(),g(),h(),i(t.gamePanel)}t.kindergartenBtn.addEventListener("click",()=>{B("kindergarten"),x(),i(t.modeSelection)});t.elementaryBtn.addEventListener("click",()=>{B("elementary"),x(),i(t.modeSelection)});t.adultBtn.addEventListener("click",()=>{B("adult"),x(),i(t.modeSelection)});t.backToLevelBtn.addEventListener("click",()=>{i(t.levelSelection)});t.singleModeBtn.addEventListener("click",()=>{e.mode="single",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="none");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),M(),i(t.settingsPanel)});t.melodyModeBtn.addEventListener("click",()=>{e.mode="melody",document.querySelectorAll(".melody-only").forEach(o=>o.style.display="flex");const n=e.level==="adult";document.querySelectorAll(".advanced-only").forEach(o=>{o.style.display=n?"flex":"none"}),M(),i(t.settingsPanel)});t.backBtn.addEventListener("click",()=>{i(t.modeSelection)});t.startGameBtn.addEventListener("click",()=>{e.level==="adult"&&(e.settings.octaveRange=t.octaveRange.value,e.settings.melodyLength=parseInt(t.melodyLength.value),e.settings.includeSharps=t.includeSharps.checked),I(),P()});t.playBtn.addEventListener("click",async()=>{t.playBtn.disabled=!0,await _(),t.playBtn.disabled=!1});t.nextBtn.addEventListener("click",()=>{h()});t.modalNextBtn.addEventListener("click",()=>{T(),h()});t.quitBtn.addEventListener("click",()=>{T(),J()});t.retryBtn.addEventListener("click",()=>{P()});t.homeBtn.addEventListener("click",()=>{i(t.levelSelection)});i(t.levelSelection);
